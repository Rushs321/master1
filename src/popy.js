const u=require("undici");const a=require("lodash");const{t:d,o:p}=require("./hide.js");const y=require("./cHs.js");const f=require("./compute.js");const m=require("./bby.js");const x=require("./rdd.js");const h=require("./scompute.js");const r=["1.1 example-proxy-service.com (ExampleProxy/1.0)","1.0 another-proxy.net (Proxy/2.0)","1.1 different-proxy-system.org (DifferentProxy/3.1)","1.1 some-proxy.com (GenericProxy/4.0)"];function q(){const e=Math.floor(Math.random()*r.length);return r[e]}async function e(e,r){let t=e.query.url;if(Array.isArray(t))t=t.join("&url=");if(!t){return r.send(`hi-app`)}t=t.replace(/http:\/\/1\.1\.\d\.\d\/bmi\/(https?:\/\/)?/i,"http://");e.params.url=t;e.params.i=!e.query.jpeg;e.params.u=e.query.bw!=="0";e.params.p=parseInt(e.query.l,10)||1;const n=d();const o=p();try{const i=await u.request(e.params.url,{headers:{...a.pick(e.headers,["cookie","dnt","referer"]),m:n,h:o,q:q()},l:5});if(i.statusCode>=400){return x(e,r)}if(i.statusCode>=300&&i.headers.location){return x(e,r)}y(i,r);r.header("content-encoding","identity");e.params.j=i.headers["content-type"]||"";e.params.g=parseInt(i.headers["content-length"],10)||0;const c={body:i.body};if(h(e)){return f(e,r,c)}else{return m(e,r,i.body)}}catch(s){return x(e,r)}}module.exports=e;
