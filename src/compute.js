"use strict";const o=require("sharp");const u=require("./redirect.js");async function e(e,t,s){const r=e.params.webp?"webp":"jpeg";try{const i=o().grayscale(e.params.grayscale).toFormat(r,{t:e.params.t,i:true,o:true,u:false});const{data:a,info:c}=await s.body.pipe(i).toBuffer({l:true});t.header("content-type","image/"+r).header("content-length",c.size).header("x-original-size",e.params.originSize).header("x-bytes-saved",e.params.originSize-c.size).code(200).send(a)}catch(n){return u(e,t)}}module.exports=e;
